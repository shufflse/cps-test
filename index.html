<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CPS Test</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.9.1/css/OverlayScrollbars.min.css" />
  <link rel="stylesheet" href="https://kingsora.github.io/OverlayScrollbars/etc/os-theme-thin-dark.css" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://kit.fontawesome.com/7dc3015a44.js" crossorigin="anonymous"></script>
</head>
<body>
  <section class="section">
    <div class="container">
      <div class="columns">
        <div class="column is-9">
          <div class="content is-medium">
            <div class="box">
              <h4 class="title is-3"><span id="timeText"></span> Second CPS Test</h4>

              <article class="message is-primary">
                <div class="message-body">
                  <input class="input" type="number" id="timeTxt" placeholder="Duration (seconds)" />
                  <div>Timer: <span id="timer">0</span></div>
                  <div>Score: <span id="score">0</span></div>
                  <div>Clicks/s: <span id="clicks">0</span></div>
                </div>
              </article>

              <div id="clickarea" class="button is-danger is-light" style="width: 500px; height: 150px;">
                <button id="start" class="button is-danger is-light" style="width: 100%; height: 100%;">Click Here</button>
              </div>

              <div style="margin-top: 10px;">
                <button id="stop" class="button is-warning is-light" style="width: 500px; height: 50px;">Stop</button>
              </div>

              <script>
                (() => {
                  let score = 0;
                  let ended = true;
                  let startTime = null;
                  let timerId = null;

                  const input = document.getElementById("timeTxt");
                  const timerTxt = document.getElementById("timer");
                  const scoreTxt = document.getElementById("score");
                  const clicksTxt = document.getElementById("clicks");
                  const timeText = document.getElementById("timeText");
                  const startBtn = document.getElementById("start");
                  const stopBtn = document.getElementById("stop");
                  const clickArea = document.getElementById("clickarea");

                  const show = elem => elem.style.display = 'inline';
                  const hide = elem => elem.style.display = 'none';

                  const updateTimeText = () => {
                    timeText.textContent = input.value || "";
                  };

                  const startGame = () => {
                    const duration = parseFloat(input.value);
                    if (isNaN(duration) || duration <= 0) {
                      alert("Please enter a valid duration.");
                      return;
                    }

                    score = 0;
                    ended = false;
                    startTime = performance.now();

                    hide(startBtn);
                    show(stopBtn);

                    timerId = setInterval(() => {
                      const total = (performance.now() - startTime) / 1000;
                      if (total < duration) {
                        timerTxt.textContent = total.toFixed(3);
                        clicksTxt.textContent = (score / total).toFixed(2);
                      } else {
                        clearInterval(timerId);
                        ended = true;
                        endGame(duration);
                      }
                    }, 50);
                  };

                  const endGame = (duration) => {
                    const actualDuration = ended ? duration : (performance.now() - startTime) / 1000;
                    const cps = (score / actualDuration).toFixed(2);
                    timerTxt.textContent = actualDuration.toFixed(3);
                    clicksTxt.textContent = cps;
                    scoreTxt.textContent = score;

                    show(startBtn);
                    hide(stopBtn);

                    setTimeout(() => {
                      alert(`Completed with ${score} clicks in ${actualDuration.toFixed(2)} seconds.\nThat's ${cps} clicks per second.`);
                    }, 100);
                  };

                  const stopGame = () => {
                    if (!ended) {
                      clearInterval(timerId);
                      ended = true;
                      const elapsed = (performance.now() - startTime) / 1000;
                      endGame(elapsed);
                    }
                  };

                  input.addEventListener("input", updateTimeText);
                  startBtn.addEventListener("click", startGame);
                  stopBtn.addEventListener("click", stopGame);
                  clickArea.addEventListener("click", () => {
                    if (!ended) {
                      score++;
                      scoreTxt.textContent = score;
                    }
                  });

                  window.addEventListener("resize", () => {
                    const divs = document.querySelectorAll(".menu-list");
                    divs.forEach(div => div.classList.toggle("tags", window.innerWidth < 768));
                  });

                  document.addEventListener("DOMContentLoaded", () => {
                    OverlayScrollbars(document.querySelectorAll("body"), {});
                    hide(stopBtn);
                    updateTimeText();
                  });
                })();
              </script>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/9000.0.1/prism.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/overlayscrollbars/1.9.1/js/OverlayScrollbars.min.js"></script>
</body>
</html>
